<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Coinluxora Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui;
  margin:0;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border-bottom:1px solid #1e293b;
}
button{
  background:#38bdf8;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
}
.container{padding:16px}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border:1px solid #1e293b;
  padding:8px;
  font-size:13px;
  word-break:break-all;
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <strong>Coinluxora Admin</strong>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">
  <h3>Deposit Addresses</h3>

  <table>
    <thead>
      <tr>
        <th>Network</th>
        <th>Address</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody id="depositRows"></tbody>
  </table>
</div>

<script>
const SUPABASE_URL = "https://xdcscknfomlzwysczegc.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkY3Nja25mb21send5c2N6ZWdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTYzMDMsImV4cCI6MjA4MzI5MjMwM30.E6o2wFFMOpK1DghLUqnxG6Ig09djy4bmDQexprhAiB4";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

// ðŸ” PROTECT DASHBOARD
checkSession();

async function checkSession(){
  const { data } = await supabaseClient.auth.getSession();
  if(!data.session){
    window.location.href = "admin.html";
  } else {
    loadDeposits();
  }
}

async function loadDeposits(){
  const { data } = await supabaseClient
    .from("deposit_addresses")
    .select("*");

  const tbody = document.getElementById("depositRows");
  tbody.innerHTML="";

  data.forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${d.network || ""}</td>
      <td>${d.address || ""}</td>
      <td>${d.notes || ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function logout(){
  await supabaseClient.auth.signOut();
  window.location.href="admin.html";
}
</script>

</body>
</html>
