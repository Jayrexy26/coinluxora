<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Authentication | Coinluxora</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#050a18;
      --stroke:rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.65);
      --danger:#ef4444;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: var(--bg);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      padding:24px;
    }

    .card{
      width:min(520px, 100%);
      background:rgba(11,18,38,.86);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:22px 22px 18px;
      box-shadow:0 16px 50px rgba(0,0,0,.45);
      position:relative;
    }

    h1{ margin:0; font-size:1.6rem; }
    .sub{ margin:8px 0 0; color:var(--muted); }

    /* DEBUG LINE */
    .debug{
      margin:12px 0 16px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:rgba(255,255,255,.85);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      overflow:auto;
    }

    .pinBoxes{
      margin:18px 0 18px;
      display:flex;
      justify-content:center;
      gap:14px;
    }
    .pinBox{
      width:56px;
      height:56px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .pinDot{
      width:14px;
      height:14px;
      border-radius:999px;
      background:transparent;
      border:1px solid rgba(255,255,255,.30);
      transition:.12s ease;
    }
    .pinBox.filled .pinDot{
      background:rgba(255,255,255,.92);
      border-color:rgba(255,255,255,.92);
      transform:scale(1.06);
    }

    .pad{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:14px;
      max-width:320px;
      margin:0 auto 18px;
    }

    .key{
      height:64px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.90);
      color:#0a0f1f;
      font-weight:800;
      font-size:1.25rem;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .key.ghost{
      background:transparent;
      color:rgba(255,255,255,.75);
    }

    .hint{
      text-align:center;
      margin:10px 0 0;
      color:rgba(234,240,255,.60);
      min-height:20px;
    }

    .danger{ color:var(--danger) !important; }
  </style>
</head>

<body>

  <div class="card">
    <h1>Secure Authentication</h1>
    <div class="sub" id="subText">Please verify your 4-digit PIN code</div>

    <div class="debug" id="debug">DEBUG: page loaded...</div>

    <div class="pinBoxes" id="pinBoxes">
      <div class="pinBox"><div class="pinDot"></div></div>
      <div class="pinBox"><div class="pinDot"></div></div>
      <div class="pinBox"><div class="pinDot"></div></div>
      <div class="pinBox"><div class="pinDot"></div></div>
    </div>

    <div class="pad" id="pad">
      <button type="button" class="key" data-num="7">7</button>
      <button type="button" class="key" data-num="0">0</button>
      <button type="button" class="key" data-num="1">1</button>

      <button type="button" class="key" data-num="2">2</button>
      <button type="button" class="key" data-num="3">3</button>
      <button type="button" class="key" data-num="8">8</button>

      <button type="button" class="key" data-num="4">4</button>
      <button type="button" class="key" data-num="5">5</button>
      <button type="button" class="key" data-num="6">6</button>

      <button type="button" class="key" data-num="9">9</button>
      <button type="button" class="key ghost" data-action="backspace">⌫</button>
      <button type="button" class="key ghost" data-action="clear">Clear</button>
    </div>

    <div class="hint" id="hint"></div>
  </div>

<script>
  // ✅ ultra-safe: errors won't stop input logic
  const debug = document.getElementById("debug");
  const pad = document.getElementById("pad");
  const hint = document.getElementById("hint");
  const pinBoxes = Array.from(document.querySelectorAll(".pinBox"));

  let input = "";

  function dbg(msg){
    debug.textContent = msg;
  }

  function renderPinBoxes(){
    pinBoxes.forEach((box, i)=>{
      box.classList.toggle("filled", i < input.length);
    });
  }

  function setHint(msg, danger=false){
    hint.textContent = msg || "";
    hint.classList.toggle("danger", !!danger);
  }

  // ✅ keypad ALWAYS works regardless of Supabase
  pad.addEventListener("click", (e)=>{
    const btn = e.target.closest("button");
    if(!btn) return;

    const num = btn.getAttribute("data-num");
    const action = btn.getAttribute("data-action");

    if(num !== null){
      if(input.length >= 4) return;
      input += String(num);
      renderPinBoxes();
      dbg(`DEBUG: tapped=${num} | input=${input}`);
      return;
    }

    if(action === "backspace"){
      input = input.slice(0, -1);
      renderPinBoxes();
      dbg(`DEBUG: backspace | input=${input}`);
      return;
    }

    if(action === "clear"){
      input = "";
      renderPinBoxes();
      dbg(`DEBUG: clear | input=${input}`);
      return;
    }
  });

  // ✅ start debug
  dbg("DEBUG: listeners attached ✅ Tap keypad now...");

  // Optional: try supabase init but don't break keypad if error
  try{
    const SUPABASE_URL = "https://xdcscknfomlzwysczegc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkY3Nja25mb21send5c2N6ZWdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY4NzE2MjUsImV4cCI6MjA1MjQ0NzYyNX0.RGOC9l-xiYk8gwQpC_XoB9XJrTz8g5og35s5t7XUL5o";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    setHint("Supabase init ✅", false);
  }catch(err){
    console.log(err);
    setHint("Supabase init failed (but keypad still works)", true);
  }
</script>

</body>
</html>
